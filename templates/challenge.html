<!doctype html>
<html>
    <head>
        <link rel="stylesheet" href="static/stylesheets/style.css">
        <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
        <!-- <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script> -->
        <script type="text/javascript" charset="utf-8">
            var ws = new WebSocket("ws://localhost:8888/ws");
            // ws.onopen = function() {
            //    ws.send("Hello, world");
            // };

var HEADER = "data:image/png;base64,";
var DUMMY ="iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAMAAAAp4XiDAAAASFBMVEUAAAAAAADMzMz/AABmZmaZmZnMAABmAACZAAAzAAAzMzP/MzPMZmaZMzPMMzP/MwD/////Zmb/ZgBmMzPMmZmZZmb/mQD/mZlxvxKlAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQffCBIMMyVTqZicAAACK0lEQVRIx43W63aDIAwA4KJJhVjrVtfu/d90kASIFlzzp5fDd5KAgJdLJwa8fB6YYojBXz4EQw1EgNPxAGDHqzpDBqDV0EN5DDoToIhagkSAOwb2DIEBRLEWINJf2DQspCQ7AwiUy0M69pEFyCR/xZCl4cTE/CgQtYoU2xZC2J6YiXNHA3ai4uApRwjaj+RBs+JWpKHLcrstiyAz3WjFUFJMk4/jf39+fqPyCdXJLmmwzi4L7+8a8avPhlwtzSQRcY0x3+9z+mSz8bSY0jRJWoEirtdxlM+IluczEXA7In+FbVm8jJ9jqIpmC2nBSjc6XXFZwvS83XwC4/wdI5pRDLczUE6TSJoPisRrDhNCkqFSmTY/pN6ZpIo05pguGZk1qawSKL3PxnznNIGHkDSjK1/q4tZNnlFI0CdNCeiTooRjXVfTTV5PJnggWTxejzNCDfJ6PdYWGd6zXHOWR7ewXi/jOrYJ8PbCvFH8cSGFlBmjQoZC/Dup68LbjAmWR39fWaOu1MRFCNg0rWesrCQTU1njuaxPZW1lX1neYRXwvgy1rkLQGN2WZVOWJHFPDZBPMUTXMVZAvZ+gnolqfBlvT6VEymGJelzryedL7M4+MFdTvIwAnDn8JnPCupbgO7KaeijHLz1xNKzseBVweTPketEQQgDagLAhssFWIl6P5j3OpK5QzgB8lXVufiFoFkl/n71fZIPlDeYsxa64+l7yH1BFUAv6ANgZ7wz/A295IO9de7kCAAAAAElFTkSuQmCC";

            ws.onmessage = function (evt) {
                var json = JSON.parse(evt.data);

                switch(json.label)
                {
                    case "operator_text":
                    case "robot_text":
                        var subtitles = document.getElementById("subtitles");
                        var txt = document.createElement("li");
                        txt.appendChild(document.createTextNode(json.text));
                        txt.setAttribute("class", json.label); // added line
                        subtitles.appendChild(txt);
                        
                        var footer = $(".footer");
                        footer.animate({ scrollTop: footer.prop("scrollHeight") - footer.height() }, 100);
                        break
                    case "challenge_step":
                        $next_active = $('#storyline li').eq(json.index)
                        $next_active.addClass('activated');
                        $next_active.prev().removeClass('activated');
                        break
                    case "image":
                        var image = "data:image/png;base64," + json.image;
                        console.log("Got image: '"+image+"'")
                        document.getElementById('visualization_img').setAttribute('src', image);
                        break;
                }
            };
            function send_to_ws() {
                var formdata = $( "#command_enter_form" ).serialize();
                ws.send(formdata);
            }
            $("#submit").on("click", send_to_ws);
        </script>

    </head>
    <body class="main">
        <div class="wrapper">
            <div class="box header"><h1>{{challenge}}</h1></div>
            <div class="box sidebar">
                <ol id="storyline">
                    {% for line in story %}
                        <li>{{ line }}</li>
                    {% end %}
                </ol>
            </div>
            <div class="box content">
                {{visualization}}
                <br>
                <img    id="visualization_img"
                        src="https://www.w3schools.com/html/html5.gif">
            </div>
            <div class="box footer">
                <ul id="subtitles">
<!--                     <li class="operator_text">Operator</li>
                    <li class="robot_text">Robot</li> -->
                </ul>
            </div>
        </div>
    </body>
</html>