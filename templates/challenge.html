<!doctype html>
<html>
    <head>
        <link rel="stylesheet" href="static/stylesheets/style.css">
        <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
        <!-- <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script> -->
        <script type="text/javascript" charset="utf-8">
            var ws = new WebSocket("ws://localhost:8888/ws");
            // ws.onopen = function() {
            //    ws.send("Hello, world");
            // };
            ws.onmessage = function (evt) {
                var json = JSON.parse(evt.data);

                switch(json.label)
                {
                    case "operator_text":
                    case "robot_text":
                        var subtitles = document.getElementById("subtitles");
                        var txt = document.createElement("li");
                        txt.appendChild(document.createTextNode(json.text));
                        txt.setAttribute("class", json.label); // added line
                        subtitles.appendChild(txt);
                        
                        var footer = $(".footer");
                        footer.animate({ scrollTop: footer.prop("scrollHeight") - footer.height() }, 100);
                        break
                    case "challenge_step":
                        $next_active = $('#storyline li').eq(json.index)
                        $next_active.addClass('activated');
                        $next_active.prev().removeClass('activated');
                        break
                }
            };
            function send_to_ws() {
                var formdata = $( "#command_enter_form" ).serialize();
                ws.send(formdata);
            }
            $("#submit").on("click", send_to_ws);
        </script>

    </head>
    <body class="main">
        <div class="wrapper">
            <div class="box header"><h1>{{challenge}}</h1></div>
            <div class="box sidebar">
                <ol id="storyline">
                    {% for line in story %}
                        <li>{{ line }}</li>
                    {% end %}
                </ol>
            </div>
            <div class="box content">{{visualization}}</div>
            <div class="box footer">
                <ul id="subtitles">
<!--                     <li class="operator_text">Operator</li>
                    <li class="robot_text">Robot</li> -->
                </ul>
            </div>
        </div>
    </body>
</html>